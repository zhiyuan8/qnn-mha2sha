#!/usr/bin/env python3
# -*- mode: python -*-
# =============================================================================
#
#  Copyright (c) Qualcomm Technologies, Inc. and/or its subsidiaries.
#  All rights reserved.
#  Confidential and Proprietary - Qualcomm Technologies, Inc.
#
# =============================================================================

import sys
import traceback

from mha2sha.converter import MHA2SHAConverter
from mha2sha.utils.arg_parser import converter_arg_parser


if __name__ == "__main__":
    try:
        parser = converter_arg_parser()
        args = vars(parser.parse_args())
        # MHA2SHAConverter takes in 'model_or_path' for the __init__.
        # Here, we update the existing flag API from the CLI to align
        # with what the __init__ is expecting.
        args["model_or_path"] = args.pop("exported_model_path")

        converter = MHA2SHAConverter(
            args.pop("model_name"),
            args.pop("sha_export_path"),
            args.pop("model_or_path"),
            args.pop("log_level"),
            **args
        )

        converter.convert()

    except Exception as e:
        print(f"Encountered Error: {str(e)}", end="\n\n")
        print('Stack Trace:')
        traceback.print_exc()
        sys.exit(1)
    sys.exit(0)
